import{e as V,f as E,g as p,_ as j,h as x,m as _,r as k,o as l,c,b as w,a as e,i as y,v as H,j as S,k as m,F as v,l as C,t as h,n as A,p as O}from"./index-9uNafTwC.js";import{u as P}from"./userPostsStore-LrayFAE-.js";import{u as L}from"./userUsersStore-Z3_-gjtb.js";import{s as b,e as u}from"./swalToasts-5Lo7J8RG.js";import{U as R}from"./UserNavbar-PQE6xaGr.js";import{U as N}from"./UserDashboard-_8PK0e6i.js";import"./user_default-gs4whxCm.js";var M={VITE_APP_URL:"https://two024-node-week4.onrender.com",BASE_URL:"/2024-node-week4_frontend/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const T=V.useLoading({}),{VITE_LOCALHOST:D}=M,B=E("userCommentsStore",{state:()=>({}),actions:{async createComment(s,t){const i=T.show(),r=`${D}/posts/${s}/comment`;try{const a=await p.post(r,{comment:t});b(a.data.message)}catch(a){u(a.response.data.message)}finally{i.hide()}},async deleteComment(s){const t=T.show(),i=`${D}/posts/${s}/uncomment`;try{const r=await p.delete(i);b(r.data.message)}catch(r){u(r.response.data.message)}finally{t.hide()}}}});var I={VITE_APP_URL:"https://two024-node-week4.onrender.com",BASE_URL:"/2024-node-week4_frontend/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const U=V.useLoading({}),{VITE_LOCALHOST:$}=I,F=E("userLikesStore",{state:()=>({}),actions:{async likePost(s){const t=U.show(),i=`${$}/posts/${s}/like`;try{const r=await p.post(i);b(r.data.message)}catch(r){u(r.response.data.message)}finally{t.hide()}},async unlikePost(s){const t=U.show(),i=`${$}/posts/${s}/unlike`;try{const r=await p.delete(i);b(r.data.message)}catch(r){u(r.response.data.message)}finally{t.hide()}}}}),z={components:{UserNavbar:R,UserDashboard:N},data(){return{timeSort:"",keyword:"",comment:""}},mounted(){this.getPosts(),this.getProfile()},computed:{...x(P,["postsList"]),...x(L,["profile"])},methods:{..._(P,["getPosts"]),..._(L,["getProfile"]),..._(B,["createComment","deleteComment"]),..._(F,["likePost","unlikePost"]),handleSearchPosts(s){this.getPosts("asc",s)},async handleLikePost(s){const t=this.postsList.find(i=>i._id===s);try{this.isLiked(t)?await this.unlikePost(s):await this.likePost(s),await this.getPosts()}catch(i){u(i.response)}},isLiked(s){return s.likes.some(t=>t._id===this.profile._id)},handleCreateComment(s,t){this.createComment(s,t),this.comment="",this.resetTextareaHeight(),this.getPosts()},handleDeleteComment(s){this.deleteComment(s).then(()=>this.getPosts())},adjustTextareaHeight(s){const t=s.target;t&&(t.style.height=`${t.scrollHeight}px`)},resetTextareaHeight(){const s=this.$refs.commentTextarea;s&&(s[0].style.height="1rem")},formattedTime(s){const t=new Date(s),i=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0"),d=String(t.getHours()).padStart(2,"0"),g=String(t.getMinutes()).padStart(2,"0"),f=String(t.getSeconds()).padStart(2,"0");return`${i}-${r}-${a} ${d}:${g}:${f}`}}},Y={class:"container py-12"},q={class:"row"},G={class:"col-8"},J={class:"row mb-4"},K={class:"col-4"},Q=e("option",{value:"",selected:""},"請選擇順序",-1),W=e("option",{value:"asc"},"從新到舊",-1),X=e("option",{value:"desc"},"從舊到新",-1),Z=[Q,W,X],ee={class:"col-8"},te={class:"input-group"},se=e("i",{class:"bi bi-search text-white fs-4"},null,-1),oe=[se],re={key:0,class:"row"},ae=O('<div class="col"><div class="bg-white rounded border border-2 border-black" style="border-bottom:4px solid black !important;"><div class="d-flex align-items-center gap-2 border-bottom border-2 border-black p-4 w-100" style="height:52px;"><div class="rounded border border-black border-1 bg-danger" style="width:10px;height:10px;"></div><div class="rounded border border-black border-1 bg-warning" style="width:10px;height:10px;"></div><div class="rounded border border-black border-1 bg-success" style="width:10px;height:10px;"></div></div><div class="text-center py-8" style="height:80px;"><p class="text-gray">目前尚無動態，新增一則貼文吧！</p></div></div></div>',1),ie=[ae],ne={key:1,class:"row gy-6"},de={class:"bg-white rounded border border-2 border-black p-6",style:{"border-bottom":"4px solid black !important"}},le={key:0,class:"d-flex gap-2 mb-4"},ce={class:"rounded-circle overflow-hidden",style:{width:"45px",height:"45px"}},he=["src","alt"],me={class:"d-flex flex-column justify-content-between text-start"},ue={class:"noto-sans-tc text-primary fw-bold"},_e={class:"baloo-da-2 text-gray"},pe={class:"noto-sans-tc mb-4"},be=["src","alt"],ge={class:"d-flex align-items-center mb-5"},fe={key:0,class:"d-flex align-items-center gap-2"},ye=e("div",{class:"rounded-circle overflow-hidden bg-primary position-relative",style:{width:"24px",height:"24px"}},[e("i",{class:"bi bi-hand-thumbs-up-fill text-white position-absolute top-50 start-50 translate-middle"})],-1),ve={class:"noto-sans-tc"},xe={class:"ms-auto"},ke={class:"d-flex align-items-center gap-2"},we=["onClick"],Se={class:"baloo-da-2 fw-bold"},Ce={class:"d-flex align-items-start gap-2 mb-4 w-100"},Pe={key:0,class:"rounded-circle overflow-hidden",style:{width:"40px",height:"40px"}},Le=["src","alt"],Te=["onClick"],De={class:"row px-4 gy-4"},Ue={class:"d-flex align-items-center gap-2 mb-1"},$e={class:"rounded-circle overflow-hidden",style:{width:"40px",height:"40px"}},Ve=["src","alt"],Ee={class:"d-flex flex-column justify-content-between text-start"},je={class:"noto-sans-tc text-primary fw-bold"},He={class:"baloo-da-2 text-gray"},Ae={class:"d-flex justify-content-between align-items-center"},Oe={class:"ms-12 mb-1",style:{width:"85%"}},Re={class:"mt-auto"},Ne=["onClick"],Me=e("i",{class:"bi bi-trash3 text-primary"},null,-1),Be=[Me],Ie={class:"col-4"};function Fe(s,t,i,r,a,d){const g=k("UserNavbar"),f=k("UserDashboard");return l(),c(v,null,[w(g),e("div",Y,[e("div",q,[e("div",G,[e("div",J,[e("div",K,[y(e("select",{onInput:t[0]||(t[0]=o=>s.getPosts(a.timeSort)),"onUpdate:modelValue":t[1]||(t[1]=o=>a.timeSort=o),class:"form-select rounded-0 border-2 border-black py-3 ps-4 pe-10","aria-label":"posts-select"},Z,544),[[H,a.timeSort]])]),e("div",ee,[e("div",te,[y(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>a.keyword=o),type:"text",class:"form-control rounded-0 border-2 border-black py-3 px-4",placeholder:"搜尋貼文","aria-label":"搜尋貼文","aria-describedby":"搜尋貼文"},null,512),[[S,a.keyword]]),e("button",{onClick:t[3]||(t[3]=o=>d.handleSearchPosts(a.keyword)),class:"btn btn-primary rounded-0 px-4",type:"button"},oe)])])]),s.postsList.length?m("",!0):(l(),c("div",re,ie)),s.postsList.length?(l(),c("div",ne,[(l(!0),c(v,null,C(s.postsList,o=>(l(),c("div",{key:o.id,class:"col-12"},[e("div",de,[o.user?(l(),c("div",le,[e("div",ce,[e("img",{src:o.user.photo,alt:`user-photo-${o.user.name}`,class:"object-fit-cover img-fluid",style:{height:"45px"}},null,8,he)]),e("div",me,[e("span",ue,h(o.user.name),1),e("small",_e,h(d.formattedTime(o.createdAt)),1)])])):m("",!0),e("p",pe,h(o.content),1),e("img",{src:o.image,alt:`photo-${o.image}`,class:"object-fit-cover img-fluid rounded border border-2 border-black mb-5"},null,8,be),e("div",ge,[o.likes.length?(l(),c("div",fe,[ye,e("small",ve,h(o.likes[0].name)+" 和其他 "+h(o.likes.length-1)+"人按讚",1)])):m("",!0),e("div",xe,[e("div",ke,[e("button",{onClick:n=>d.handleLikePost(o._id),type:"button",class:"btn p-0"},[e("i",{class:A([d.isLiked(o)?"bi bi-hand-thumbs-up-fill":"bi bi-hand-thumbs-up","fs-5 text-primary"])},null,2)],8,we),e("span",Se,h(o.likes.length),1)])])]),e("div",Ce,[s.profile._id?(l(),c("div",Pe,[e("img",{src:s.profile.photo,alt:`user-photo-${s.profile.name}`,class:"object-fit-cover img-fluid",style:{height:"40px"}},null,8,Le)])):m("",!0),y(e("textarea",{ref_for:!0,ref:"commentTextarea","onUpdate:modelValue":t[4]||(t[4]=n=>a.comment=n),class:"form-control rounded border-2 border-black py-2 px-4",placeholder:"留言...","aria-label":"留言","aria-describedby":"留言",rows:"1",style:{flex:"3",overflow:"hidden",resize:"none"},onInput:t[5]||(t[5]=(...n)=>d.adjustTextareaHeight&&d.adjustTextareaHeight(...n))},null,544),[[S,a.comment]]),e("button",{onClick:n=>d.handleCreateComment(o._id,a.comment),class:"btn btn-primary rounded border-2 border-primary px-4 py-2 text-white",type:"button",style:{flex:"1"}},"留言",8,Te)]),e("div",De,[(l(!0),c(v,null,C(o.comments,n=>(l(),c("div",{key:n._id,class:"col-12 rounded p-4",style:{"background-color":"rgb(239 236 231 / 50%)"}},[e("div",Ue,[e("div",$e,[e("img",{src:n.user.photo,alt:`user-photo-${n.user.name}`,class:"object-fit-cover img-fluid",style:{height:"40px"}},null,8,Ve)]),e("div",Ee,[e("span",je,h(n.user.name),1),e("small",He,h(d.formattedTime(n.createdAt)),1)])]),e("div",Ae,[e("p",Oe,h(n.comment),1),e("div",Re,[e("button",{onClick:ze=>d.handleDeleteComment(n._id),type:"button",class:"btn p-0"},Be,8,Ne)])])]))),128))])])]))),128))])):m("",!0)]),e("div",Ie,[w(f)])])])],64)}const Xe=j(z,[["render",Fe]]);export{Xe as default};
