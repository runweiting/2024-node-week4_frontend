import{s as f,u as g,x as r,z as p,i as y}from"./index-vR0ayCj_.js";import{s as c,e as d}from"./swalToasts-T3TvksEA.js";var w={VITE_APP_URL:"https://two024-node-week4.onrender.com",VITE_LOCALHOST:"http://localhost:3010",BASE_URL:"/2024-node-week4_frontend/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const l=f.useLoading({}),{VITE_APP_URL:u}=w,P=g("userUsersStore",{state:()=>({profile:{},likedPosts:[]}),actions:{async signUp(s,o,e,t){const a=l.show(),n=`${u}/users/sign-up`;try{const i=await r.post(n,{name:s,email:o,password:e,confirmPassword:t}),{expires:m,token:h}=i.data;document.cookie=`myToken=${h}; expires=${m}`,c(i.data.message),p.push({name:"sign-in"})}catch(i){d(i.response.data.message)}finally{a.hide()}},async signIn(s,o){const e=l.show(),t=`${u}/users/sign-in`;if(y())c("您已登入！"),p.push({name:"metawall"});else try{const a=await r.post(t,{email:s,password:o}),{expired:n,token:i}=a.data;document.cookie=`myToken=${i}; expires=${new Date(n)}`,r.defaults.headers.common.Authorization=`Bearer ${i}`,p.push({name:"metawall"}),c(a.data.message)}catch(a){d(a.response.data.message)}finally{e.hide()}},async signOut(){const s=l.show(),o=`${u}/users/sign-out`;try{await r.post(o),document.cookie="myToken=; expires=;",r.defaults.headers.common.Authorization=null,c("登出成功"),p.push({name:"sign-in"})}catch(e){d(e.response.data.message)}finally{s.hide()}},async getProfile(){const s=l.show(),o=`${u}/users/profile`;try{const e=await r.get(o),{data:t}=e.data;this.profile=t,c(e.data.message)}catch(e){d(e.response.data.message)}finally{s.hide()}},async updateProfile(s,o){const e=l.show(),t=`${u}/users/profile`;try{const a=await r.put(t,{name:s,gender:o}),{data:n}=a.data;this.profile=n,p.push({name:"profile"}),c(a.data.message)}catch(a){d(a.response.data.message)}finally{e.hide()}},async updatePassword(s,o){const e=l.show(),t=`${u}/users/update-password`;try{const a=await r.patch(t,{password:s,confirmPassword:o}),{expired:n,token:i}=a.data;document.cookie=`myToken=${i}; expires=${new Date(n)}`,r.defaults.headers.common.Authorization=null;const m=`${a.data.message}，請重新登入！`;c(m)}catch(a){d(a.response.data.message)}finally{e.hide()}},async uploadFile(){const s=l.show(),e=document.querySelector("#formFile").files[0],t=new FormData;t.append("file-to-upload",e);const a=`${u}/upload/file`;try{const n=await r.post(a,t);c(n.data.message),this.getProfile()}catch(n){d(n.response.data.message)}finally{s.hide()}},async getLikedPosts(){const s=l.show(),o=`${u}/users/liked-posts`;try{const e=await r.get(o),{data:t}=e.data;this.likedPosts=t}catch(e){d(e.response.data.message)}finally{s.hide()}},async deleteLikedPost(s){const o=l.show(),e=`${u}/users/${s}/liked-post`;try{const t=await r.delete(e);c(t.data.message)}catch(t){d(t.response.data.message)}finally{o.hide()}}},getters:{getUserProfile:s=>s.profile,getUserLikedPosts:s=>s.likedPosts}});export{P as u};
