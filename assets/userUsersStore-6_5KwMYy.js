import{u as f,x as g,y as r,z as p,i as y}from"./index-YBCA0vwM.js";import{s as d,e as c}from"./swalToasts-9FqNNr8f.js";var w={VITE_APP_URL:"https://two024-node-week4.onrender.com",BASE_URL:"/2024-node-week4_frontend/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const l=f.useLoading({}),{VITE_APP_URL:u}=w,P=g("userUsersStore",{state:()=>({profile:{},likedPosts:[]}),actions:{async signUp(s,o,e,a){const t=l.show(),n=`${u}/users/sign-up`;try{const i=await r.post(n,{name:s,email:o,password:e,confirmPassword:a}),{expires:m,token:h}=i.data;document.cookie=`myToken=${h}; expires=${m}`,d(i.data.message),p.push({name:"sign-in"})}catch(i){c(i.response.data.message)}finally{t.hide()}},async signIn(s,o){const e=l.show(),a=`${u}/users/sign-in`;if(y())d("您已登入！"),p.push({name:"metawall"});else try{const t=await r.post(a,{email:s,password:o}),{expired:n,token:i}=t.data;document.cookie=`myToken=${i}; expires=${new Date(n)}`,r.defaults.headers.common.Authorization=`Bearer ${i}`,p.push({name:"metawall"}),d(t.data.message)}catch(t){c(t.response.data.message)}finally{e.hide()}},async signOut(){const s=l.show(),o=`${u}/users/sign-out`;try{await r.post(o),document.cookie="myToken=; expires=;",r.defaults.headers.common.Authorization=null,d("登出成功"),p.push({name:"sign-in"})}catch(e){c(e.response.data.message)}finally{s.hide()}},async getProfile(){const s=l.show(),o=`${u}/users/profile`;try{const e=await r.get(o),{data:a}=e.data;this.profile=a,d(e.data.message)}catch(e){c(e.response.data.message)}finally{s.hide()}},async updateProfile(s,o){const e=l.show(),a=`${u}/users/profile`;try{const t=await r.put(a,{name:s,gender:o}),{data:n}=t.data;this.profile=n,p.push({name:"profile"}),d(t.data.message)}catch(t){c(t.response.data.message)}finally{e.hide()}},async updatePassword(s,o){const e=l.show(),a=`${u}/users/update-password`;try{const t=await r.patch(a,{password:s,confirmPassword:o}),{expired:n,token:i}=t.data;document.cookie=`myToken=${i}; expires=${new Date(n)}`,r.defaults.headers.common.Authorization=null;const m=`${t.data.message}，請重新登入！`;d(m)}catch(t){c(t.response.data.message)}finally{e.hide()}},async uploadFile(){const s=l.show(),e=document.querySelector("#formFile").files[0],a=new FormData;a.append("file-to-upload",e);const t=`${u}/upload/file`;try{const n=await r.post(t,a);d(n.data.message),this.getProfile()}catch(n){c(n.response.data.message)}finally{s.hide()}},async getLikedPosts(){const s=l.show(),o=`${u}/users/liked-posts`;try{const e=await r.get(o),{data:a}=e.data;this.likedPosts=a}catch(e){c(e.response.data.message)}finally{s.hide()}},async deleteLikedPost(s){const o=l.show(),e=`${u}/users/${s}/liked-post`;try{const a=await r.delete(e);d(a.data.message)}catch(a){c(a.response.data.message)}finally{o.hide()}}},getters:{getUserProfile:s=>s.profile,getUserLikedPosts:s=>s.likedPosts}});export{P as u};
