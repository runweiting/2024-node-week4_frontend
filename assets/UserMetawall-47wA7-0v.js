import{_ as k,f as g,m as h,r as w,o as i,c as l,a as e,g as m,v as C,h as f,j as c,F as b,k as u,l as P,w as S,t as d,n as L,p as j}from"./index-_W54mxzm.js";import{p as v}from"./postsStore-OJ4UynLN.js";import{u as y}from"./userUsersStore-QOHeHN1G.js";import{u as T,a as A}from"./userLikesStore-erEOLUlD.js";import{w as D}from"./swalToasts-YyeuVwFm.js";import{f as H}from"./formatCreatedAt-CTMo6T3e.js";const V={data(){return{timeSort:"",keyword:"",comment:""}},mounted(){this.getPosts(),this.getProfile()},computed:{...g(v,["postsList"]),...g(y,["profile"])},methods:{...h(v,["getPosts"]),...h(y,["getProfile"]),...h(T,["createComment","deleteComment"]),...h(A,["handleLikePost","isLiked","likePost","unlikePost"]),handleSearchPosts(s){this.getPosts("asc",s)},handleCreateComment(s,o){this.createComment(s,o),this.comment="",this.resetTextareaHeight(),this.getPosts()},handleDeleteComment(s,o,p){o!==p?D("無法刪除他人留言"):this.deleteComment(s).then(()=>this.getPosts())},adjustTextareaHeight(s){const o=s.target;o&&(o.style.height=`${o.scrollHeight}px`)},resetTextareaHeight(){const s=this.$refs.commentTextarea;s&&(s[0].style.height="1rem")},formatCreatedAt:H}},U={class:"col-8"},B={class:"row mb-4"},M={class:"col-4"},N=e("option",{value:"",selected:""},"請選擇順序",-1),z=e("option",{value:"asc"},"從新到舊",-1),F=e("option",{value:"desc"},"從舊到新",-1),I=[N,z,F],R={class:"col-8"},E={class:"input-group"},q=e("i",{class:"bi bi-search text-white fs-4"},null,-1),G=[q],J={key:0,class:"row"},K=j('<div class="col"><div class="bg-white rounded border border-2 border-black" style="border-bottom:4px solid black !important;"><div class="d-flex align-items-center gap-2 border-bottom border-2 border-black p-4 w-100" style="height:52px;"><div class="rounded border border-black border-1 bg-danger" style="width:10px;height:10px;"></div><div class="rounded border border-black border-1 bg-warning" style="width:10px;height:10px;"></div><div class="rounded border border-black border-1 bg-success" style="width:10px;height:10px;"></div></div><div class="text-center py-8" style="height:80px;"><p class="text-gray">目前尚無動態，新增一則貼文吧！</p></div></div></div>',1),O=[K],Q={key:1,class:"row gy-6"},W={class:"bg-white rounded border border-2 border-black p-6",style:{"border-bottom":"4px solid black !important"}},X={class:"rounded-circle overflow-hidden",style:{width:"45px",height:"45px"}},Y=["src","alt"],Z={class:"d-flex flex-column justify-content-between text-start"},$={class:"noto-sans-tc text-primary fw-bold"},ee={class:"baloo-da-2 text-gray"},te={class:"noto-sans-tc mb-4"},se=["src","alt"],oe={class:"d-flex gap-2 mb-5"},re={class:"d-flex align-items-center mb-5"},ie={key:0,class:"d-flex align-items-center gap-2"},le=e("div",{class:"rounded-circle overflow-hidden bg-primary position-relative",style:{width:"24px",height:"24px"}},[e("i",{class:"bi bi-hand-thumbs-up-fill text-white position-absolute top-50 start-50 translate-middle"})],-1),de={class:"noto-sans-tc"},ae={class:"ms-auto"},ne={class:"d-flex align-items-center gap-2"},ce=["onClick"],he={class:"baloo-da-2 fw-bold"},me={class:"d-flex align-items-start gap-2 mb-4 w-100"},be={key:0,class:"rounded-circle overflow-hidden",style:{width:"40px",height:"40px"}},ue=["src","alt"],pe=["onClick"],_e={class:"row px-4 gy-4"},ge={class:"d-flex align-items-center gap-2 mb-1"},fe={class:"rounded-circle overflow-hidden",style:{width:"40px",height:"40px"}},ve=["src","alt"],ye={class:"d-flex flex-column justify-content-between text-start"},xe={class:"noto-sans-tc text-primary fw-bold"},ke={class:"baloo-da-2 text-gray"},we={class:"d-flex justify-content-between align-items-center"},Ce={class:"ms-12 mb-1",style:{width:"85%"}},Pe={class:"mt-auto"},Se=["onClick"],Le=e("i",{class:"bi bi-trash3 text-primary"},null,-1),je=[Le];function Te(s,o,p,Ae,a,n){const x=w("RouterLink");return i(),l("div",U,[e("div",B,[e("div",M,[m(e("select",{onInput:o[0]||(o[0]=t=>s.getPosts(a.timeSort)),"onUpdate:modelValue":o[1]||(o[1]=t=>a.timeSort=t),class:"form-select rounded-0 border-2 border-black py-3 ps-4 pe-10","aria-label":"posts-select"},I,544),[[C,a.timeSort]])]),e("div",R,[e("div",E,[m(e("input",{"onUpdate:modelValue":o[2]||(o[2]=t=>a.keyword=t),type:"search",class:"form-control rounded-0 border-2 border-black py-3 px-4",placeholder:"搜尋貼文","aria-label":"搜尋貼文","aria-describedby":"搜尋貼文"},null,512),[[f,a.keyword]]),e("button",{onClick:o[3]||(o[3]=t=>n.handleSearchPosts(a.keyword)),class:"btn btn-primary rounded-0 px-4",type:"button"},G)])])]),s.postsList.length?c("",!0):(i(),l("div",J,O)),s.postsList.length?(i(),l("div",Q,[(i(!0),l(b,null,u(s.postsList,t=>(i(),l("div",{key:t.id,class:"col-12"},[e("div",W,[t.user?(i(),P(x,{key:0,to:{name:"user",params:{id:t.user._id}},class:"d-flex gap-2 mb-4 text-black text-decoration-none"},{default:S(()=>[e("div",X,[e("img",{src:t.user.photo,alt:`user-photo-${t.user.name}`,class:"object-fit-cover img-fluid",style:{height:"45px"}},null,8,Y)]),e("div",Z,[e("span",$,d(t.user.name),1),e("small",ee,d(n.formatCreatedAt(t.createdAt).formattedDateAndTime),1)])]),_:2},1032,["to"])):c("",!0),e("p",te,d(t.content),1),e("img",{src:t.image,alt:`photo-${t.image}`,class:"object-fit-cover img-fluid rounded border border-2 border-black mb-2"},null,8,se),e("div",oe,[(i(!0),l(b,null,u(t.tags,(r,_)=>(i(),l("span",{key:_,class:"badge rounded-pill bg-secondary text-black noto-sans-tc border border-2 border-black"},d(r),1))),128))]),e("div",re,[t.likes.length?(i(),l("div",ie,[le,e("small",de,d(t.likes[0].user.name)+" 和其他 "+d(t.likes.length-1)+"人按讚",1)])):c("",!0),e("div",ae,[e("div",ne,[e("button",{onClick:r=>s.handleLikePost("metawall",t._id,s.profile._id,null),type:"button",class:"btn p-0"},[e("i",{class:L([s.isLiked(t,s.profile._id)?"bi bi-hand-thumbs-up-fill":"bi bi-hand-thumbs-up","fs-5 text-primary"])},null,2)],8,ce),e("span",he,d(t.likes.length),1)])])]),e("div",me,[s.profile._id?(i(),l("div",be,[e("img",{src:s.profile.photo,alt:`user-photo-${s.profile.name}`,class:"object-fit-cover img-fluid",style:{height:"40px"}},null,8,ue)])):c("",!0),m(e("textarea",{ref_for:!0,ref:"commentTextarea","onUpdate:modelValue":o[4]||(o[4]=r=>a.comment=r),class:"form-control rounded border-2 border-black py-2 px-4",placeholder:"留言...","aria-label":"留言","aria-describedby":"留言",rows:"1",style:{flex:"3",overflow:"hidden",resize:"none"},onInput:o[5]||(o[5]=(...r)=>n.adjustTextareaHeight&&n.adjustTextareaHeight(...r))},null,544),[[f,a.comment]]),e("button",{onClick:r=>n.handleCreateComment(t._id,a.comment),class:"btn btn-warning rounded border-2 border-primary px-4 py-2",type:"button",style:{flex:"1"}},"留言",8,pe)]),e("div",_e,[(i(!0),l(b,null,u(t.comments,r=>(i(),l("div",{key:r._id,class:"col-12 rounded p-4",style:{"background-color":"rgb(239 236 231 / 50%)"}},[e("div",ge,[e("div",fe,[e("img",{src:r.user.photo,alt:`user-photo-${r.user.name}`,class:"object-fit-cover img-fluid",style:{height:"40px"}},null,8,ve)]),e("div",ye,[e("span",xe,d(r.user.name),1),e("small",ke,d(n.formatCreatedAt(r.createdAt).formattedDateAndTime),1)])]),e("div",we,[e("p",Ce,d(r.comment),1),e("div",Pe,[e("button",{onClick:_=>n.handleDeleteComment(r._id,r.user._id,s.profile._id),type:"button",class:"btn p-0"},je,8,Se)])])]))),128))])])]))),128))])):c("",!0)])}const Ne=k(V,[["render",Te]]);export{Ne as default};
