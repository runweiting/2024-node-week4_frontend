import{S as m,p as w,q as g,s as r,u as p,x as y}from"./index-45r4NXzb.js";function d(a){return new Promise(o=>{m.mixin({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!1,didOpen:s=>{s.addEventListener("mouseenter",m.stopTimer),s.addEventListener("mouseleave",m.resumeTimer)}}).fire({icon:"error",title:a}).then(()=>{o()})})}function c(a){return new Promise(o=>{m.mixin({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!1,didOpen:s=>{s.addEventListener("mouseenter",m.stopTimer),s.addEventListener("mouseleave",m.resumeTimer)}}).fire({icon:"success",title:a}).then(()=>{o()})})}var $={VITE_APP_URL:"https://two024-node-week4.onrender.com",BASE_URL:"/2024-node-week4_frontend/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const l=w.useLoading({}),{VITE_APP_URL:u}=$,k=g("userUsersStore",{state:()=>({profile:{}}),actions:{async signUp(a,o,e,s){const t=l.show(),n=`${u}/users/sign-up`;try{const i=await r.post(n,{name:a,email:o,password:e,confirmPassword:s}),{expires:f,token:h}=i.data;document.cookie=`myToken=${h}; expires=${f}`,c(i.data.message),p.push({name:"sign-in"})}catch(i){d(i.response.data.message)}finally{t.hide()}},async signIn(a,o){const e=l.show(),s=`${u}/users/sign-in`;if(y())c("您已登入！"),p.push({name:"metawall"});else try{const t=await r.post(s,{email:a,password:o}),{expired:n,token:i}=t.data;document.cookie=`myToken=${i}; expires=${new Date(n)}`,r.defaults.headers.common.Authorization=`Bearer ${i}`,p.push({name:"metawall"}),c(t.data.message)}catch(t){d(t.response.data.message)}finally{e.hide()}},async getProfile(){const a=l.show(),o=`${u}/users/profile`;try{const e=await r.get(o),{data:s}=e.data;this.profile=s,c(e.data.message)}catch(e){d(e.response.data.message)}finally{a.hide()}},async updateProfile(a,o){const e=l.show(),s=`${u}/users/profile`;try{const t=await r.patch(s,{name:a,gender:o}),{data:n}=t.data;this.profile=n,c(t.data.message)}catch(t){d(t.response.data.message)}finally{e.hide()}},async updatePassword(a,o){const e=l.show(),s=`${u}/users/update-password`;try{const t=await r.patch(s,{password:a,confirmPassword:o}),{expired:n,token:i}=t.data;document.cookie=`myToken=${i}; expires=${new Date(n)}`,r.defaults.headers.common.Authorization=null;const f=`${t.data.message}，請重新登入！`;c(f)}catch(t){d(t.response.data.message)}finally{e.hide()}},async signOut(){const a=l.show(),o=`${u}/users/sign-out`;try{await r.post(o),document.cookie="myToken=; expires=;",r.defaults.headers.common.Authorization=null,c("登出成功"),p.push({name:"sign-in"})}catch(e){d(e.response.data.message)}finally{a.hide()}},async uploadFile(){const a=l.show(),e=document.querySelector("#formFile").files[0],s=new FormData;s.append("file-to-upload",e);const t=`${u}/upload/file`;try{const n=await r.post(t,s);c(n.data.message),this.getProfile()}catch(n){d(n.response.data.message)}finally{a.hide()}}}});export{c as a,d as s,k as u};
