import{l as f,p as g,q as r,x as p,y}from"./index-oNhqvqyD.js";import{s as i,e as l}from"./swalToasts-kg3gisn3.js";var w={VITE_APP_URL:"https://two024-node-week4.onrender.com",BASE_URL:"/2024-node-week4_frontend/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const c=f.useLoading({}),{VITE_LOCALHOST:d}=w,P=g("userUsersStore",{state:()=>({profile:{},followingList:[],likedPosts:[]}),actions:{async signUp(s,t,e,a){const o=c.show(),n=`${d}/users/sign-up`;try{const u=await r.post(n,{name:s,email:t,password:e,confirmPassword:a}),{expires:m,token:h}=u.data;document.cookie=`myToken=${h}; expires=${m}`,i(u.data.message),p.push({name:"sign-in"})}catch(u){l(u.response.data.message)}finally{o.hide()}},async signIn(s,t){const e=c.show(),a=`${d}/users/sign-in`;if(y())i("您已登入！"),p.push({name:"metawall"});else try{const o=await r.post(a,{email:s,password:t}),{expired:n,token:u}=o.data;document.cookie=`myToken=${u}; expires=${new Date(n)}`,r.defaults.headers.common.Authorization=`Bearer ${u}`,p.push({name:"metawall"}),i(o.data.message)}catch(o){l(o.response.data.message)}finally{e.hide()}},async signOut(){const s=c.show(),t=`${d}/users/sign-out`;try{await r.post(t),document.cookie="myToken=; expires=;",r.defaults.headers.common.Authorization=null,i("登出成功"),p.push({name:"sign-in"})}catch(e){l(e.response.data.message)}finally{s.hide()}},async getProfile(){const s=c.show(),t=`${d}/users/profile`;try{const e=await r.get(t),{data:a}=e.data;this.profile=a,i(e.data.message)}catch(e){l(e.response.data.message)}finally{s.hide()}},async updateProfile(s,t){const e=c.show(),a=`${d}/users/profile`;try{const o=await r.put(a,{name:s,gender:t}),{data:n}=o.data;this.profile=n,p.push({name:"profile"}),i(o.data.message)}catch(o){l(o.response.data.message)}finally{e.hide()}},async updatePassword(s,t){const e=c.show(),a=`${d}/users/update-password`;try{const o=await r.patch(a,{password:s,confirmPassword:t}),{expired:n,token:u}=o.data;document.cookie=`myToken=${u}; expires=${new Date(n)}`,r.defaults.headers.common.Authorization=null;const m=`${o.data.message}，請重新登入！`;i(m)}catch(o){l(o.response.data.message)}finally{e.hide()}},async uploadFile(){const s=c.show(),e=document.querySelector("#formFile").files[0],a=new FormData;a.append("file-to-upload",e);const o=`${d}/upload/file`;try{const n=await r.post(o,a);i(n.data.message),this.getProfile()}catch(n){l(n.response.data.message)}finally{s.hide()}},async getFollowingList(){const s=c.show(),t=`${d}/users/following`;try{const e=await r.get(t),{data:a}=e.data;this.followingList=a,i(e.data.message)}catch(e){l(e.response.data.message)}finally{s.hide()}},async getLikedPosts(){const s=c.show(),t=`${d}/users/liked-posts`;try{const e=await r.get(t),{data:a}=e.data;this.likedPosts=a}catch(e){l(e.response.data.message)}finally{s.hide()}},async deleteLikedPost(s){const t=c.show(),e=`${d}/users/${s}/liked-post`;try{const a=await r.delete(e);i(a.data.message)}catch(a){l(a.response.data.message)}finally{t.hide()}}},getters:{getUserProfile:s=>s.profile,getUserLikedPosts:s=>s.likedPosts}});export{P as u};
